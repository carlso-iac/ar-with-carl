<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>GeoAR Final Fix</title>
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>
    <style>
      .controls { position: fixed; bottom: 20px; left: 10px; right: 10px; z-index: 1000; display: flex; flex-direction: column; gap: 10px; }
      button { background: #007bff; color: white; border: none; padding: 15px; border-radius: 8px; font-weight: bold; }
      #info { position: fixed; top: 10px; left: 10px; background: rgba(0,0,0,0.7); color: white; padding: 10px; border-radius: 5px; font-family: monospace; z-index: 1000; }
    </style>
  </head>

  <body style="margin: 0; overflow: hidden;">
    <div id="info">Dist: -- | Scale: 10</div>

    <div class="controls">
      <button onclick="snapToMe()">1. BRING TO ME (5m away)</button>
      <button onclick="increaseScale()">2. MAKE BIGGER</button>
      <button onclick="rotateModel()">3. SPIN MODEL</button>
    </div>

    <a-scene
      vr-mode-ui="enabled: false"
      embedded
      arjs="sourceType: webcam; debugUIEnabled: false; videoTexture: true;"
    >
      <a-assets>
        <a-asset-item id="myModel" src="model.glb"></a-asset-item>
      </a-assets>

      <a-camera gps-camera rotation-reader></a-camera>

      <a-entity
        id="geo-entity"
        gltf-model="#myModel"
        scale="10 10 10"
        position="0 0 0"
        gps-entity-place="latitude: 14.559854; longitude: 121.007834;"
      >
      </a-entity>
    </a-scene>

    <script>
      const model = document.querySelector('#geo-entity');
      const info = document.querySelector('#info');
      let currentScale = 10;
      let currentRotation = 0;

      // Update Distance Info
      window.addEventListener('gps-camera-update-position', (e) => {
        const d = model.getAttribute('distance');
        info.innerText = `Dist: ${d ? Math.round(d) : '--'}m | Scale: ${currentScale}`;
      });

      function snapToMe() {
        navigator.geolocation.getCurrentPosition((pos) => {
          const lat = pos.coords.latitude + 0.00005; // 5 meters North
          const lng = pos.coords.longitude;
          model.setAttribute('gps-entity-place', `latitude: ${lat}; longitude: ${lng};`);
          // Set at eye level (1.6 meters up)
          model.setAttribute('position', '0 1.6 0');
          alert("Model moved 5m North of you at eye-level!");
        });
      }

      function increaseScale() {
        currentScale *= 2;
        model.setAttribute('scale', `${currentScale} ${currentScale} ${currentScale}`);
      }

      function rotateModel() {
        currentRotation += 45;
        model.setAttribute('rotation', `0 ${currentRotation} 0`);
      }
    </script>
  </body>
</html>
