<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>GeoAR Diagnostic</title>
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>
  </head>

  <body style="margin: 0; overflow: hidden;">
    <div style="position: fixed; top: 10px; width:100%; text-align: center; z-index: 10; color: white; background: rgba(0,0,0,0.5);">
        <p id="status">Wait for GPS...</p>
        <button onclick="forceHere()" style="padding: 10px;">FORCE TO MY FEET</button>
    </div>

    <a-scene
      vr-mode-ui="enabled: false"
      embedded
      arjs="sourceType: webcam; debugUIEnabled: false;"
    >
      <a-assets>
        <a-asset-item id="myModel" src="model.glb"></a-asset-item>
      </a-assets>

      <a-camera gps-camera rotation-reader></a-camera>

      <a-light type="ambient" color="#FFF"></a-light>
      <a-light type="directional" color="#FFF" intensity="1.5" position="-1 2 1"></a-light>

      <a-entity id="anchor" gps-entity-place="latitude: 14.5598; longitude: 121.0078;">
          <a-box material="color: red;" scale="2 2 2" position="0 1 0"></a-box>
          
          <a-entity 
            gltf-model="#myModel" 
            scale="15 15 15" 
            position="0 1 0">
          </a-entity>
      </a-entity>

    </a-scene>

    <script>
      const status = document.querySelector('#status');
      const anchor = document.querySelector('#anchor');

      window.addEventListener('gps-camera-update-position', (e) => {
        status.innerText = `Accuracy: ${e.detail.position.accuracy.toFixed(1)}m`;
      });

      function forceHere() {
        navigator.geolocation.getCurrentPosition((pos) => {
          anchor.setAttribute('gps-entity-place', `latitude: ${pos.coords.latitude}; longitude: ${pos.coords.longitude};`);
          alert("Moved box and model to your current GPS spot!");
        });
      }
    </script>
  </body>
</html>
