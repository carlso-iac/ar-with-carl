<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>GeoAR Fixed</title>
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
  </head>

  <body style="margin: 0; overflow: hidden;">
    <div style="position: fixed; top: 10px; width:100%; text-align: center; z-index: 10; color: white; background: rgba(0,0,0,0.7); padding: 10px; font-family: sans-serif;">
        <div id="status">Acquiring GPS...</div>
        <button onclick="forceHere()" style="margin-top: 5px; padding: 8px;">üìç DROP AT MY FEET</button>
    </div>

    <a-scene
      vr-mode-ui="enabled: false"
      embedded
      arjs="sourceType: webcam; debugUIEnabled: false; videoTexture: true;">
      
      <a-assets>
        <a-asset-item id="myModel" src="model.glb"></a-asset-item>
      </a-assets>

      <a-camera gps-camera="minDistance: 1; maxDistance: 50;" rotation-reader></a-camera>

      <a-light type="ambient" intensity="0.7"></a-light>
      <a-light type="directional" intensity="1.2" position="-1 4 2"></a-light>

      <a-entity id="anchor" gps-entity-place="latitude: 14.5598; longitude: 121.0078;">
          <a-box material="color: red; opacity: 0.6;" scale="0.5 0.5 0.5" position="0 0 0"></a-box>
          
          <a-entity 
            gltf-model="#myModel" 
            scale="3 3 3" 
            position="0 0 0"
            animation-mixer>
          </a-entity>
      </a-entity>

    </a-scene>

    <script>
      const status = document.querySelector('#status');
      const anchor = document.querySelector('#anchor');

      // Listen for GPS updates to show accuracy
      window.addEventListener('gps-camera-update-position', (e) => {
        const acc = e.detail.position.accuracy;
        status.innerHTML = `GPS Accuracy: ${acc.toFixed(1)}m<br><small style="color: ${acc > 20 ? 'red' : 'lime'}">${acc > 20 ? 'Poor Signal' : 'Good Signal'}</small>`;
      });

      function forceHere() {
        navigator.geolocation.getCurrentPosition((pos) => {
          const lat = pos.coords.latitude;
          const lon = pos.coords.longitude;
          anchor.setAttribute('gps-entity-place', `latitude: ${lat}; longitude: ${lon};`);
          status.innerText = "Model dropped at your feet!";
        }, (err) => {
          alert("Error getting GPS: " + err.message);
        }, { enableHighAccuracy: true });
      }
    </script>
  </body>
</html>